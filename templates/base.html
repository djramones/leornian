{% load static %}
<!doctype html>
<html lang="en" {% if colormode %}data-bs-theme="{{ colormode }}"{% endif %}>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}Leornian{% endblock %}</title>
        <link rel="stylesheet" href="{% static 'bootstrap/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'bootstrap/bootstrap-icons.min.css' %}">
    </head>
    <body>
        {% block navigation %}
        <nav class="col-lg-8 mx-auto p-4">
            <ul class="nav nav-underline">
                {% with namespace=request.resolver_match.namespace url_name=request.resolver_match.url_name %}
                <li class="nav-item">
                    <a class="nav-link link-body-emphasis" href="{% url 'home' %}">
                        <strong>Leornian</strong>
                    </a>
                </li>
                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link {% if url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">Start</a>
                </li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link" href="#">About</a>
                </li>
                <li class="nav-item me-auto">
                    <a class="nav-link" href="#">Help</a>
                </li>

                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link icon-link {% if namespace == 'notes' and url_name == 'create-note' %}active{% endif %}" href="{% url 'notes:create-note' %}">
                        <i class="bi-file-earmark-plus"></i>
                        <span class="d-none d-lg-block">New Note</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link icon-link {% if namespace == 'notes' and url_name == 'my-collection' %}active{% endif %}" href="{% url 'notes:my-collection' %}">
                        <i class="bi-collection"></i>
                        <span class="d-none d-lg-block">Collection</span>
                    </a>
                </li>
                {% endif %}
                <li class="nav-item">
                    {% if not user.is_authenticated %}
                    <a class="nav-link icon-link {% if url_name == 'login' %}active{% endif %}" href="{% url 'login' %}">
                        <i class="bi-box-arrow-in-right"></i> Log In
                    </a>
                    {% else %}
                    <a class="nav-link icon-link {% if url_name == 'my-account' %}active{% endif %}" href="{% url 'my-account' %}">
                        <i class="bi-person-circle"></i>
                        <span class="d-none d-lg-block">Account</span>
                    </a>
                    {% endif %}
                </li>
                {% endwith %}
            </ul>
        </nav>
        {% endblock %}

        {% if messages %}
            <div class="col-lg-8 mx-auto px-4">
            {% for message in messages %}
                <div class="alert {% if message.tags %}{{ message.tags }}{% else %}alert-secondary{% endif %} my-2">
                    {{ message }}
                </div>
            {% endfor %}
            </div>
        {% endif %}

        <main class="col-lg-8 mx-auto p-4 pt-lg-5">
            {% block content_pre %}{% endblock %}
            {% block content %}{% endblock %}
            {% block content_post %}{% endblock %}
        </main>
        <footer class="col-lg-8 mx-auto p-4">
            <hr>
            <small id="footerSmall" class="text-secondary d-flex flex-wrap gap-2 column-gap-4">
                <strong>Leornian</strong>
                <a class="icon-link link-secondary" href="https://github.com/djramones/leornian">
                    Platform source on GitHub
                    <i class="bi-box-arrow-up-right"></i>
                </a>
            </small>
        </footer>
        <script src="{% static 'bootstrap/bootstrap.bundle.min.js' %}"></script>
        <script>
            /* Theme color mode toggle */
            window.onload = (event) => {
                // Get theme setting from HTML, or compute a default. This
                // means that the color mode cookie (set later) should be
                // processed in the Django template.
                let currTheme =
                    document.documentElement.getAttribute('data-bs-theme')
                if (currTheme == null) {
                    currTheme = window.matchMedia(
                        '(prefers-color-scheme: dark)'
                    ).matches ? 'dark' : 'light'
                }

                function setColorMode() {
                    document.documentElement.setAttribute(
                        'data-bs-theme', currTheme)
                    // Set a cookie with 400-day max-age. See:
                    // https://developer.chrome.com/blog/cookie-max-age-expires/
                    document.cookie =
                        `colormode=${currTheme};path=/;max-age=34560000`
                }

                // Apply current theme setting. Also ensures that the
                // cookie expiration date is extended on every visit:
                setColorMode()

                // Set up toggle:
                function toggleColorMode(event) {
                    if (currTheme == 'light') { currTheme = 'dark' }
                        else { currTheme = 'light' }

                    setColorMode()
                    event.preventDefault()
                }
                document.getElementById("footerSmall").insertAdjacentHTML(
                    'beforeend',
                    `<a id="colorModeToggle" class="icon-link link-secondary" href="#" role="button">
                        <i class="bi-moon-stars"></i> Toggle dark mode
                    </a>`
                )
                document.getElementById('colorModeToggle').addEventListener(
                    'click', toggleColorMode)
            }
        </script>
    </body>
</html>
